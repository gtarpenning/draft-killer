# Setup Automation Documentation

This document explains the automated setup infrastructure created for Draft Killer.

---

## 📁 Files Created

### 1. `setup.sh` - One-Command Setup Script

**Purpose:** Automates the entire local development setup

**What it does:**
1. ✅ Checks for required tools (Docker, Python, Node.js)
2. ✅ Starts PostgreSQL in Docker (creates container if needed)
3. ✅ Creates Python virtual environment (`backend/venv/`)
4. ✅ Installs Python dependencies
5. ✅ Creates `backend/.env` from template
6. ✅ Generates secure `SECRET_KEY` automatically
7. ✅ Runs database migrations
8. ✅ Installs frontend dependencies
9. ✅ Creates `frontend/.env.local`
10. ✅ Creates `start-dev.sh` convenience script

**Usage:**
```bash
./setup.sh
```

**Intelligent behavior:**
- Skips steps that are already complete
- Reuses existing virtual environment
- Doesn't reinstall dependencies if already present
- Safe to run multiple times (idempotent)

---

### 2. `start-dev.sh` - Development Server Launcher

**Purpose:** Starts both backend and frontend servers with one command

**What it does:**
1. Checks if PostgreSQL is running (starts it if not)
2. Activates Python virtual environment
3. Starts backend on http://localhost:8000
4. Starts frontend on http://localhost:3000

**Usage:**
```bash
./start-dev.sh
```

**Note:** This script is auto-generated by `setup.sh`

---

### 3. `docker-compose.yml` - PostgreSQL Container

**Purpose:** Defines PostgreSQL database container

**Configuration:**
- **Image:** PostgreSQL 15 Alpine (lightweight)
- **Container name:** `draft_killer_db`
- **Database:** `draft_killer`
- **User:** `draft_killer`
- **Password:** `draft_killer_dev_password` (dev only!)
- **Port:** 5432 (mapped to host)
- **Volume:** `postgres_data` (persists data)
- **Health check:** Ensures database is ready

**Commands:**
```bash
# Start
docker-compose up -d postgres

# Stop
docker-compose down

# Stop and delete data
docker-compose down -v

# View logs
docker logs draft_killer_db
```

---

### 4. `backend/.env.example` - Backend Environment Template

**Purpose:** Template for backend environment variables

**Includes:**
- Database connection strings (pre-configured for Docker)
- Placeholder for `SECRET_KEY` (auto-generated by setup script)
- Placeholder for `WANDB_API_KEY` (user must add)
- Default configuration for development

**Auto-configured values:**
- `DATABASE_URL` - Points to Docker PostgreSQL
- `DATABASE_URL_ASYNC` - Async version
- `CORS_ORIGINS` - Allows localhost:3000
- `ENVIRONMENT` - Set to development
- `DEBUG` - Enabled

---

### 5. `frontend/.env.example` - Frontend Environment Template

**Purpose:** Template for frontend environment variables

**Includes:**
- `NEXT_PUBLIC_API_URL` - Pre-configured to http://localhost:8000

**Note:** The setup script copies this to `.env.local` automatically

---

### 6. `Makefile` - Convenient Command Shortcuts

**Purpose:** Provides memorable commands for common tasks

**Available commands:**

**Setup & Start:**
```bash
make setup          # Run setup.sh
make start          # Start both servers
make start-backend  # Backend only
make start-frontend # Frontend only
```

**Database:**
```bash
make db-up         # Start PostgreSQL
make db-down       # Stop PostgreSQL
make db-reset      # Reset database (deletes data!)
make db-migrate    # Run migrations
make db-connect    # Open psql CLI
```

**Dependencies:**
```bash
make install-backend   # Install Python packages
make install-frontend  # Install npm packages
```

**Maintenance:**
```bash
make clean  # Remove caches and generated files
make test   # Run tests (placeholder)
```

---

### 7. `QUICKSTART.md` - Quick Reference Guide

**Purpose:** Simple, focused guide for getting started quickly

**Covers:**
- One-command setup
- How to start development
- Common commands
- Troubleshooting
- Environment variables reference

---

## 🎯 Design Philosophy

### Idempotent Operations
All scripts can be run multiple times safely. They check if steps are already complete and skip them.

### Progressive Enhancement
Scripts detect what's already set up and only do what's needed:
- Existing virtual environment? Reuse it.
- Dependencies installed? Skip installation.
- PostgreSQL running? Don't restart it.

### Clear Feedback
Scripts provide color-coded output:
- 🔵 Blue: Information
- 🟢 Green: Success
- 🟡 Yellow: Warnings/actions being taken
- 🔴 Red: Errors

### Fail Fast
Scripts exit immediately on errors to prevent cascading failures.

### Smart Defaults
Everything is pre-configured to work out of the box:
- Database credentials for development
- CORS settings for localhost
- Debug mode enabled
- Secure SECRET_KEY auto-generated

---

## 🔄 Workflow Comparison

### Before Automation:
```bash
# Install PostgreSQL (OS-specific)
brew install postgresql  # or apt-get, or download installer...

# Start PostgreSQL
brew services start postgresql

# Create database
createdb draft_killer

# Setup backend
cd backend
python -m venv venv
source venv/bin/activate
pip install -r requirements.txt
cp .env.example .env
# Edit .env manually...
openssl rand -hex 32  # Copy this...
# Paste into .env...
alembic upgrade head

# Setup frontend
cd ../frontend
npm install
cp .env.example .env.local

# Start backend (new terminal)
cd backend
source venv/bin/activate
uvicorn app.main:app --reload

# Start frontend (another terminal)
cd frontend
npm run dev
```

**Time:** ~15-20 minutes, multiple terminals, error-prone

### After Automation:
```bash
./setup.sh
# Add WANDB_API_KEY to backend/.env
./start-dev.sh
```

**Time:** ~2-3 minutes, one command, foolproof

---

## 🐳 Why Docker for PostgreSQL?

### Advantages:
1. **Cross-platform:** Works on macOS, Linux, Windows
2. **No system pollution:** Doesn't install PostgreSQL globally
3. **Isolated:** Won't conflict with other PostgreSQL instances
4. **Easy cleanup:** `docker-compose down -v` removes everything
5. **Consistent:** Every developer gets the same PostgreSQL version
6. **Portable:** Same setup for local dev and CI/CD

### Persistent Data:
Data is stored in a Docker volume named `postgres_data`. This means:
- Data survives container restarts
- Data survives Docker Desktop restarts
- Data is only deleted with `docker-compose down -v`

### View Data Location:
```bash
docker volume inspect draft_killer_postgres_data
```

---

## 🔧 Customization

### Change PostgreSQL Credentials

Edit `docker-compose.yml`:
```yaml
environment:
  POSTGRES_DB: my_db_name
  POSTGRES_USER: my_username
  POSTGRES_PASSWORD: my_secure_password
```

Then update `backend/.env.example` to match.

### Change PostgreSQL Port

Edit `docker-compose.yml`:
```yaml
ports:
  - "5433:5432"  # Use 5433 on host instead of 5432
```

Then update connection strings in `backend/.env.example`.

### Use System PostgreSQL Instead

1. Install PostgreSQL normally
2. Create database: `createdb draft_killer`
3. Update `backend/.env`:
   ```
   DATABASE_URL=postgresql://your_user@localhost/draft_killer
   ```
4. Skip Docker steps in `setup.sh` (or just don't use it)

---

## 🔍 Behind the Scenes

### Virtual Environment Management

The script creates `backend/venv/` and maintains a marker file `.dependencies_installed` to track if packages are installed. This prevents reinstalling packages on every run.

### Secure Key Generation

The setup script generates a cryptographically secure 32-byte key using OpenSSL:
```bash
SECRET_KEY=$(openssl rand -hex 32)
```

This is automatically inserted into `backend/.env`, replacing the placeholder.

### Migration Intelligence

The script checks if migrations exist before trying to create new ones:
```bash
if [ ! -d "alembic/versions" ] || [ -z "$(ls -A alembic/versions)" ]; then
    # Create initial migration
fi
```

### Docker Health Checks

The script waits for PostgreSQL to be fully ready before proceeding:
```bash
docker exec draft_killer_db pg_isready -U draft_killer
```

---

## 🐛 Troubleshooting

### Setup script fails immediately
**Cause:** Missing prerequisites (Docker, Python, or Node.js)
**Solution:** Install the missing tool and re-run

### "Port 5432 already in use"
**Cause:** Another PostgreSQL is running
**Solutions:**
- Stop it: `brew services stop postgresql`
- Or change port in `docker-compose.yml`

### Dependencies not installing
**Cause:** Network issues or package conflicts
**Solution:** 
```bash
cd backend
rm -rf venv
./setup.sh  # Will recreate venv
```

### Database connection fails
**Cause:** PostgreSQL container not running
**Solution:**
```bash
docker ps | grep draft_killer_db  # Check if running
docker start draft_killer_db      # Start if stopped
```

---

## 📊 File Structure After Setup

```
draft-killer/
├── backend/
│   ├── venv/                 # Created by setup.sh
│   │   └── .dependencies_installed
│   ├── .env                  # Created by setup.sh
│   └── alembic/
│       └── versions/         # Migrations created
│
├── frontend/
│   ├── node_modules/         # Created by setup.sh
│   └── .env.local            # Created by setup.sh
│
├── docker-compose.yml        # PostgreSQL definition
├── setup.sh                  # Main setup script
├── start-dev.sh              # Created by setup.sh
├── Makefile                  # Convenient commands
├── QUICKSTART.md             # Quick reference
└── SETUP_AUTOMATION.md       # This file
```

---

## 🎓 Learning Resources

**Docker:**
- Official docs: https://docs.docker.com/
- Docker Compose: https://docs.docker.com/compose/

**Shell scripting:**
- Bash guide: https://mywiki.wooledge.org/BashGuide
- ShellCheck (linter): https://www.shellcheck.net/

**Make:**
- GNU Make: https://www.gnu.org/software/make/manual/

---

## 🚀 Future Enhancements

Potential improvements:

1. **Windows support** - Add `.bat` or PowerShell scripts
2. **Alternative databases** - Support for SQLite in development
3. **CI/CD integration** - GitHub Actions workflow
4. **Pre-commit hooks** - Auto-format, lint, test
5. **Dev containers** - VS Code devcontainer.json
6. **Test data seeding** - Populate database with sample data
7. **Backup/restore** - Easy database backup scripts

---

**The goal of this automation is simple: eliminate friction from local development so you can focus on building features! 🎯**

