# Setup Automation - Complete Guide

This directory now includes comprehensive setup automation to make local development **extremely easy**.

---

## 🎯 TL;DR - Quick Start

```bash
./setup.sh          # One-time setup (2-3 minutes)
# Add your W&B API key to backend/.env
./start-dev.sh      # Start development
```

**That's it!** 🎉

---

## 📦 What Was Created

### Core Automation Files

1. **`setup.sh`** ⭐
   - Main setup script
   - One command to set everything up
   - Checks prerequisites
   - Starts PostgreSQL in Docker
   - Creates virtual environment
   - Installs all dependencies
   - Runs database migrations
   - Creates environment files
   - Generates secure keys

2. **`start-dev.sh`**
   - Convenience script (auto-generated by setup.sh)
   - Starts both backend and frontend
   - Handles PostgreSQL startup
   - Activates virtual environment

3. **`docker-compose.yml`**
   - PostgreSQL 15 in Docker
   - Pre-configured database
   - Persistent data volume
   - Health checks

4. **`Makefile`**
   - Convenient command shortcuts
   - `make setup`, `make start`, etc.
   - Database management commands
   - Dependency installation helpers

### Configuration Templates

5. **`backend/.env.example`**
   - Backend environment variables
   - Database URLs (pre-configured for Docker)
   - Placeholders for secrets
   - Development defaults

6. **`frontend/.env.example`**
   - Frontend environment variables
   - API URL configuration

### Documentation

7. **`QUICKSTART.md`** 📖
   - Quick reference guide
   - Common commands
   - Troubleshooting
   - Environment variables reference

8. **`SETUP_AUTOMATION.md`** 📘
   - Detailed technical documentation
   - How everything works
   - Customization options
   - Advanced troubleshooting

9. **`SETUP_VISUAL_GUIDE.md`** 📊
   - Visual flowcharts
   - Architecture diagrams
   - File structure trees
   - Command reference tables

10. **`AUTOMATION_README.md`** 📝
    - This file!
    - Overview of all automation

---

## 🚀 Getting Started

### Prerequisites

Install these **once**:

- **Docker Desktop** - https://www.docker.com/products/docker-desktop
- **Python 3.11+** - https://www.python.org/downloads/
- **Node.js 18+** - https://nodejs.org/

### First Time Setup

**Step 1: Run setup**
```bash
chmod +x setup.sh  # Make executable (if needed)
./setup.sh
```

**Step 2: Add your W&B API key**

Edit `backend/.env` and replace:
```
WANDB_API_KEY=your-wandb-api-key-here
```

Get your key from: https://wandb.ai/authorize

**Step 3: Start development**
```bash
./start-dev.sh
```

**Step 4: Open browser**
- Frontend: http://localhost:3000
- Backend API: http://localhost:8000/docs

---

## 📚 Documentation Guide

**Which document should I read?**

| Document | When to Read |
|----------|-------------|
| `QUICKSTART.md` | Just want to get started quickly |
| `SETUP_VISUAL_GUIDE.md` | Prefer diagrams and visual explanations |
| `SETUP_AUTOMATION.md` | Want to understand how it works |
| `SETUP_GUIDE.md` | Prefer manual setup or having issues |
| `../README.md` | Want project overview |
| `IMPLEMENTATION_OUTLINE.md` | Want to see the full roadmap |
| `DEVELOPMENT_NOTES.md` | Want to understand design decisions |

---

## 🎮 Common Commands

### Setup & Start

```bash
# First time
./setup.sh

# Start development (every day)
./start-dev.sh

# Or with Make
make setup
make start
```

### Database

```bash
# Using Make (easier)
make db-up          # Start PostgreSQL
make db-down        # Stop PostgreSQL
make db-reset       # Reset database (deletes data!)
make db-migrate     # Run migrations
make db-connect     # Open database CLI

# Or using Docker directly
docker-compose up -d postgres
docker-compose down
docker logs draft_killer_db
docker exec -it draft_killer_db psql -U draft_killer
```

### Manual Start (two terminals)

**Terminal 1 - Backend:**
```bash
cd backend
source venv/bin/activate
uvicorn app.main:app --reload
```

**Terminal 2 - Frontend:**
```bash
cd frontend
npm run dev
```

---

## 🔧 How It Works

### PostgreSQL in Docker

Instead of installing PostgreSQL on your system, we run it in a Docker container:

**Benefits:**
- ✅ Works on any OS
- ✅ No system pollution
- ✅ Easy to reset
- ✅ Consistent across team
- ✅ Data persists between restarts

**The container:**
- Name: `draft_killer_db`
- Database: `draft_killer`
- User/Password: `draft_killer` / `draft_killer_dev_password`
- Port: 5432
- Volume: `postgres_data` (persists data)

### Smart Setup Script

The `setup.sh` script is **idempotent** - it can be run multiple times safely:

- Virtual environment exists? Reuse it.
- Dependencies installed? Skip installation.
- PostgreSQL running? Don't restart.
- Migrations applied? Skip them.

It also **auto-generates** secure values:
- `SECRET_KEY` using OpenSSL
- Replaces placeholders in `.env`

### Auto-Generated Start Script

`setup.sh` creates `start-dev.sh` which:
- Checks if PostgreSQL is running (starts if not)
- Activates Python virtual environment
- Starts backend on port 8000
- Starts frontend on port 3000

---

## 🎯 What Gets Created

### Files

```
✨ Created by setup.sh:
├── backend/venv/              # Python virtual environment
├── backend/.env               # Backend configuration
├── frontend/node_modules/     # Frontend dependencies
├── frontend/.env.local        # Frontend configuration
├── start-dev.sh              # Start script
└── backend/alembic/versions/  # Database migrations
```

### Docker Resources

```
🐳 Created by docker-compose:
├── Container: draft_killer_db
└── Volume: postgres_data (persistent storage)
```

---

## 🐛 Common Issues

### "Docker not found"

**Install Docker Desktop:**
- macOS/Windows: https://www.docker.com/products/docker-desktop
- Linux: `sudo apt-get install docker.io docker-compose`

### "Port 5432 already in use"

**Another PostgreSQL is running:**
```bash
# macOS
brew services stop postgresql

# Linux
sudo systemctl stop postgresql
```

**Or change the port** in `docker-compose.yml`:
```yaml
ports:
  - "5433:5432"  # Use 5433 instead
```

### "Backend won't start"

**Check if you added W&B API key:**
```bash
grep WANDB_API_KEY backend/.env
```

Should show your actual key, not `your-wandb-api-key-here`.

### "Frontend can't connect to backend"

**Is backend running?**
```bash
curl http://localhost:8000/health
```

Should return: `{"status":"healthy",...}`

### "Module not found" (Python)

**Reinstall dependencies:**
```bash
cd backend
rm -rf venv
../setup.sh  # Will recreate venv
```

### "Module not found" (Node)

**Reinstall dependencies:**
```bash
cd frontend
rm -rf node_modules
npm install
```

---

## 🎓 Advanced Usage

### Customize PostgreSQL

Edit `docker-compose.yml`:

```yaml
environment:
  POSTGRES_DB: my_custom_db
  POSTGRES_USER: my_user
  POSTGRES_PASSWORD: my_secure_password
ports:
  - "5433:5432"  # Custom port
```

Then update `backend/.env.example` to match.

### View Docker Logs

```bash
docker logs -f draft_killer_db
```

### Connect to Database

```bash
# Using Make
make db-connect

# Or directly
docker exec -it draft_killer_db psql -U draft_killer -d draft_killer
```

### Backup Database

```bash
docker exec draft_killer_db pg_dump -U draft_killer draft_killer > backup.sql
```

### Restore Database

```bash
docker exec -i draft_killer_db psql -U draft_killer draft_killer < backup.sql
```

### Complete Reset

**WARNING: This deletes ALL data!**

```bash
docker-compose down -v  # Delete volume
./setup.sh             # Recreate everything
```

---

## 📊 Before vs After

### Before Automation

```
1. Install PostgreSQL (OS-specific, error-prone)
2. Configure PostgreSQL
3. Create database manually
4. Create virtual environment
5. Install Python dependencies
6. Edit .env manually
7. Generate SECRET_KEY manually
8. Copy to .env manually
9. Run migrations
10. Install frontend dependencies
11. Edit frontend .env manually
12. Start backend (remember command)
13. Start frontend (remember command)

Time: 15-20 minutes
Errors: Common
Terminals: 2+
```

### After Automation

```
1. ./setup.sh
2. Add W&B API key
3. ./start-dev.sh

Time: 2-3 minutes
Errors: Rare
Terminals: 1
```

---

## 🎁 Bonus Features

### Make Commands

For developers who prefer `make`:

```bash
make setup           # Run setup.sh
make start           # Start both servers
make start-backend   # Backend only
make start-frontend  # Frontend only
make db-up          # Start PostgreSQL
make db-down        # Stop PostgreSQL
make db-reset       # Reset database
make db-migrate     # Run migrations
make db-connect     # Database CLI
make clean          # Remove caches
```

### Environment Validation

The backend automatically validates all environment variables on startup:

- SECRET_KEY must be 32+ characters
- SECRET_KEY can't be the default value
- Required variables must be present
- Helpful error messages if misconfigured

### Secure by Default

- `SECRET_KEY` auto-generated with OpenSSL (32 bytes)
- Database credentials isolated in Docker
- `.env` files in `.gitignore`
- CORS properly configured for localhost

---

## 🔄 Typical Workflow

### Day 1 (First Time)

```bash
./setup.sh
# Edit backend/.env to add WANDB_API_KEY
./start-dev.sh
# Code, test, commit
```

### Day 2+ (Subsequent Days)

```bash
./start-dev.sh
# Code, test, commit
```

### When Adding Features

```bash
# Make code changes
# Backend auto-reloads
# Frontend auto-reloads

# If you change database models:
cd backend
source venv/bin/activate
alembic revision --autogenerate -m "Description"
alembic upgrade head
```

---

## 📖 Further Reading

- **Quick Start:** [QUICKSTART.md](./QUICKSTART.md)
- **Visual Guide:** [SETUP_VISUAL_GUIDE.md](./SETUP_VISUAL_GUIDE.md)
- **Technical Details:** [SETUP_AUTOMATION.md](./SETUP_AUTOMATION.md)
- **Manual Setup:** [SETUP_GUIDE.md](./SETUP_GUIDE.md)
- **Project Overview:** [README.md](../README.md)

---

## 🎉 Summary

**What you get:**
- ✅ One-command setup
- ✅ PostgreSQL in Docker (no installation needed)
- ✅ All dependencies installed
- ✅ Database migrations applied
- ✅ Secure keys generated
- ✅ Environment files created
- ✅ One-command start script
- ✅ Make shortcuts
- ✅ Comprehensive documentation

**Time saved:** ~15 minutes per setup, ~5 minutes per day

**Errors prevented:** Configuration issues, missing dependencies, wrong versions

**Developer happiness:** 📈📈📈

---

**Ready to start? Run: `./setup.sh` 🚀**

